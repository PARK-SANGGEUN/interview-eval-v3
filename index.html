<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>모두의 1:1 대입 면접 평가 v3.6</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {font-family:'Pretendard Variable',sans-serif;background:#fff;color:#1E2A38;margin:0;}
header {background:#1E2A38;color:#fff;text-align:center;padding:2rem 1rem;}
main {max-width:950px;margin:2rem auto;padding:1rem;}
input[type=text]{padding:.5rem;border:1px solid #ccc;border-radius:6px;margin:.3rem;width:45%;}
input:focus{outline:2px solid #FF7A00;}
.card {background:#fff;border:1px solid #E5E7EB;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05);margin-bottom:1.2rem;}
.card h2 {background:#F9FAFB;margin:0;padding:1rem;border-bottom:1px solid #E5E7EB;cursor:pointer;font-size:1.1rem;display:flex;justify-content:space-between;align-items:center;}
.card-content {display:none;padding:1.2rem;animation:slide .3s ease;}
@keyframes slide {from{opacity:0;transform:translateY(-5px);}to{opacity:1;transform:translateY(0);}}
table {width:100%;border-collapse:collapse;font-size:.9rem;}
th,td {border:1px solid #E5E7EB;padding:.6rem;text-align:center;word-break:keep-all;cursor:pointer;}
@media(max-width:768px){td,th{display:block;width:100%;}}
.feedback-box {background:#F5FAF8;border:1px solid #D1E7DD;border-radius:6px;padding:.6rem;width:100%;height:80px;margin-top:.6rem;font-size:.95rem;}
.comment-select {width:100%;margin-top:.5rem;padding:.5rem;border:1px solid #ccc;border-radius:6px;}
button {background:#FF7A00;color:#fff;border:none;border-radius:8px;padding:.8rem 1.2rem;font-size:1rem;cursor:pointer;margin:.5rem;}
button:hover{background:#e56f00;}
.note {font-size:.9rem;color:#555;background:#f9f9f9;padding:.8rem;border-radius:6px;margin-bottom:1.5rem;}
.grade-A{background:#DCFCE7!important;} .grade-B{background:#E7F6E9!important;}
.grade-C{background:#FEF9C3!important;} .grade-D{background:#FFEDD5!important;}
.grade-E{background:#FEE2E2!important;} .selected{font-weight:bold;border:2px solid #FF7A00;}
#student-info{background:#F8FAFC;border-radius:10px;padding:1rem;margin-bottom:1.5rem;border:1px solid #E5E7EB;}
#summary{height:100px;}
</style>
</head>
<body>
<header>
  <h1>모두의 1:1 대입 면접 평가 v3.6</h1>
  <p>학생별 루브릭 기반 피드백 시스템 (선생님용)</p>
</header>

<main>
  <div id="student-info">
    <label>학생 이름:</label> <input type="text" id="studentName" placeholder="예: 김지원">
    <label>대학:</label> <input type="text" id="university" placeholder="예: 경희대학교"><br>
    <label>학과:</label> <input type="text" id="major" placeholder="예: 물리학과">
    <label>차시:</label> <input type="text" id="session" placeholder="예: 2차 면접">
  </div>

  <div class="note">
    💬 <strong>사용 안내</strong><br>
    각 항목을 클릭하면 해당 루브릭이 펼쳐집니다.<br>
    루브릭 표의 A~E 칸을 클릭하면 색상이 자동 반영되며, 피드백에 코멘트가 추가됩니다.<br>
    모든 입력 내용은 자동 저장되며, [💾 PDF 저장] 버튼으로 파일을 내려받아 직접 공유하세요.
  </div>

  <!-- 항목 템플릿 -->
  <div id="rubrics"></div>

  <div class="card">
    <h2 onclick="toggleCard(this)">⑥ 종합 피드백 <span>▼</span></h2>
    <div class="card-content">
      <textarea id="summary" class="feedback-box" placeholder="종합 피드백 입력 또는 수정 가능"></textarea>
    </div>
  </div>

  <div style="text-align:center;">
    <button onclick="savePDF()">💾 PDF 저장</button>
  </div>
</main>

<script>
const rubricData=[
  {id:1,title:'① 표현 및 소통능력',criteria:'말의 명료성, 논리 구성, 면접 태도',
   comments:{A:'논리적으로 자신의 생각을 명확히 전달함.',E:'소통 및 이해에 어려움이 있음.'}},
  {id:2,title:'② 전공적합성',criteria:'전공 관련 경험, 진로 동기',
   comments:{A:'전공에 대한 이해가 깊고 동기가 명확함.',E:'전공과의 관련성이 낮고 답변이 모호함.'}},
  {id:3,title:'③ 탐구력',criteria:'논리적 사고, 문제해결, 지적 호기심',
   comments:{A:'문제를 깊이 분석하고 창의적 대안을 제시함.',E:'사고력과 논리 구조의 개선이 필요함.'}},
  {id:4,title:'④ 인성',criteria:'협업, 배려, 책임감',
   comments:{A:'성실하고 타인을 배려하는 태도가 돋보임.',E:'소극적이며 책임감 표현이 미흡함.'}},
  {id:5,title:'⑤ 성장 가능성',criteria:'자기성찰, 발전의지, 계획',
   comments:{A:'자기 성찰과 발전 의지가 뚜렷함.',E:'성찰 부족 및 계획 구체화 필요.'}},
];
window.onload=()=>{
  const container=document.getElementById('rubrics');
  rubricData.forEach(r=>{
    container.innerHTML+=`
    <div class="card">
      <h2 onclick="toggleCard(this)">${r.title} <span>▼</span></h2>
      <div class="card-content">
        <table id="rubric${r.id}">
          <tr><th>세부 기준</th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th></tr>
          <tr>
            <td>${r.criteria}</td>
            <td onclick="selectGrade(this,${r.id},'A')">A</td>
            <td onclick="selectGrade(this,${r.id},'B')">B</td>
            <td onclick="selectGrade(this,${r.id},'C')">C</td>
            <td onclick="selectGrade(this,${r.id},'D')">D</td>
            <td onclick="selectGrade(this,${r.id},'E')">E</td>
          </tr>
        </table>
        <textarea id="feedback${r.id}" class="feedback-box" placeholder="피드백 입력 또는 수정 가능"></textarea>
      </div>
    </div>`;
  });
  loadData();
};

function toggleCard(el){
  document.querySelectorAll('.card-content').forEach(c=>c.style.display='none');
  el.nextElementSibling.style.display='block';
}

function selectGrade(cell,idx,grade){
  const row=cell.parentNode;
  row.querySelectorAll('td').forEach(td=>td.classList.remove('selected','grade-A','grade-B','grade-C','grade-D','grade-E'));
  cell.classList.add('selected','grade-'+grade);
  const fb=document.getElementById('feedback'+idx);
  const c=rubricData.find(x=>x.id===idx).comments;
  fb.value=c[grade]||'';
  saveData();
}

function saveData(){
  const data={
    student:document.getElementById('studentName').value,
    univ:document.getElementById('university').value,
    major:document.getElementById('major').value,
    session:document.getElementById('session').value,
    feedbacks:rubricData.map(r=>document.getElementById('feedback'+r.id).value),
    summary:document.getElementById('summary').value
  };
  localStorage.setItem('interviewEval',JSON.stringify(data));
}

function loadData(){
  const data=JSON.parse(localStorage.getItem('interviewEval')||'{}');
  if(!data)return;
  document.getElementById('studentName').value=data.student||'';
  document.getElementById('university').value=data.univ||'';
  document.getElementById('major').value=data.major||'';
  document.getElementById('session').value=data.session||'';
  (data.feedbacks||[]).forEach((fb,i)=>{
    const id=i+1;
    if(fb)document.getElementById('feedback'+id).value=fb;
  });
  document.getElementById('summary').value=data.summary||'';
}

['studentName','university','major','session','summary'].forEach(id=>{
  document.getElementById(id).addEventListener('input',saveData);
});
document.addEventListener('input',e=>{
  if(e.target.classList.contains('feedback-box'))saveData();
});

function savePDF(){
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF({orientation:'p',unit:'mm',format:'a4'});
  let y=20;
  doc.setFontSize(14);
  const name=document.getElementById('studentName').value||'학생';
  const univ=document.getElementById('university').value||'대학';
  const major=document.getElementById('major').value||'학과';
  const session=document.getElementById('session').value||'차시';
  doc.text(`모두의 1:1 대입 면접 평가 (${session})`,20,y);
  y+=10;
  doc.setFontSize(11);
  doc.text(`학생: ${name}   대학: ${univ}   학과: ${major}`,20,y);
  y+=10;
  rubricData.forEach(r=>{
    let fb=document.getElementById('feedback'+r.id).value;
    if(fb){
      const lines=doc.splitTextToSize(`${r.title}: ${fb}`,170);
      doc.text(lines,20,y);
      y+=lines.length*6+5;
    }
  });
  let summary=document.getElementById('summary').value;
  if(summary){
    const lines=doc.splitTextToSize(`종합 피드백: ${summary}`,170);
    doc.text(lines,20,y);
  }
  const filename=`${name}-${univ}-${major}-면접피드백-${session}.pdf`;
  doc.save(filename);
}
</script>
</body>
</html>
